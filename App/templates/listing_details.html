{% extends "layout.html" %}
{% block title %}Apartment Reviews{% endblock %}
{% block page %}Listing Details{% endblock %}

{% block content %}
  <div class="container mt-4">
    {% if listing %}
    <div class="card mb-4" style="border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
      <div class="card-body" style="padding: 2rem;">
        <h1 style="color: #2c3e50; margin-bottom: 1.5rem;">{{ listing.title }}</h1>
        <img src="{{ url_for('static', filename='images/listing' ~ listing.id ~ '.jpg') }}" 
             alt="{{ listing.title }}" 
             class="listing-image" 
             style="width: 100%; max-height: 400px; object-fit: cover; border-radius: 8px; margin-bottom: 1.5rem;">

        <p style="font-size: 1.1rem; color: #34495e; margin-bottom: 1rem;">
          <i class="fas fa-bed" style="color: #3498db;"></i> {{ listing.bedrooms }} Bedroom(s) |
          <i class="fas fa-bath" style="color: #3498db;"></i> {{ listing.bathrooms }} Bathroom(s) |
          <i class="fas fa-dollar-sign" style="color: #2ecc71;"></i> {{ listing.price }} per month
        </p>

        <p style="font-size: 1.1rem; color: #34495e; margin-bottom: 1.5rem;">
          <i class="fas fa-map-marker-alt" style="color: #e74c3c;"></i> {{ listing.location }}
        </p>

        <h3 style="color: #2c3e50; margin-bottom: 1rem;">Description</h3>
        <p style="color: #7f8c8d; line-height: 1.6;">{{ listing.description or "No description provided" }}</p>

        <h3 style="color: #2c3e50; margin-top: 2rem; margin-bottom: 1rem;">Reviews</h3>
        {% if reviews %}
          {% for review in reviews %}
            <div class="card mb-2" style="border-radius: 8px; border-left: 4px solid #3498db;">
              <div class="card-body" style="padding: 1.25rem;">
                <p style="color: #2c3e50; margin-bottom: 0.5rem;">{{ review.text }}</p>
                <small class="text-muted" style="font-size: 0.85rem;">
                  Posted by Tenant {{ review.tenant.username }} |
                  {% if review.rating %}
                    Rating: 
                    {% for i in range(review.rating) %}
                      <i class="fas fa-star" style="color: #f39c12;"></i>
                    {% endfor %}
                  {% else %}
                    No rating provided
                  {% endif %}
                  {% if review.updated_at %}
                    on {{ review.updated_at.strftime('%B %d, %Y') }}
                  {% endif %}
                  {% if review.created_at and review.created_at != review.updated_at %}
                    (originally posted on {{ review.created_at.strftime('%B %d, %Y') }})
                  {% endif %}
                  {% if review.created_at %}
                    on {{ review.created_at.strftime('%B %d, %Y') }}
                  {% endif %}
                </small>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <p style="color: #7f8c8d;">No reviews yet.</p>
        {% endif %}
      </div>
    </div>
      <a href="{{ url_for('index_views.index_page') }}" class="btn btn-secondary">Back to Listings</a>
    {% else %}
      <div class="alert alert-danger">Listing not found</div>
      <a href="{{ url_for('index_views.index_page') }}" class="btn btn-secondary">Back to Listings</a>
    {% endif %}
  </div>
{% endblock %}