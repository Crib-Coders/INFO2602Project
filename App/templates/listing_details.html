{% extends "layout.html" %}

{% block content %}
  <div class="container mt-4">
    {% if listing %}
      <div class="card mb-4">
        <div class="card-body">
          <h1>{{ listing.title }}</h1>
          <img src="{{ url_for('static', filename='images/listing' ~ listing.id ~ '.jpg') }}" alt="{{ listing.title }}" class="listing-image" >
          <p>
            <i class="fas fa-bed"></i> {{ listing.bedrooms }} Bedroom(s) |
            <i class="fas fa-bath"></i> {{ listing.bathrooms }} Bathroom(s) |
            <i class="fas fa-dollar-sign"></i> {{ listing.price }} per month
          </p>
          <p><i class="fas fa-map-marker-alt"></i> {{ listing.location }}</p>
          
          <h3>Description</h3>
          <p>{{ listing.description or "No description provided" }}</p>
          
          <h3>Reviews</h3>
          {% if reviews %}
            {% for review in reviews %}
              <div class="card mb-2">
                <div class="card-body">
                  <p>{{ review.text }}</p>
                  <small class="text-muted">
                    Posted by Tenant {{ review.tenant.username }} |
                    {% if review.rating %}
                      Rating: {{ review.rating }} stars
                    {% else %}
                      No rating provided
                    {% endif %}
                    {% if review.updated_at %}
                      on {{ review.updated_at.strftime('%B %d, %Y') }}
                    {% endif %}
                    {% if review.created_at and review.created_at != review.updated_at %}
                      (originally posted on {{ review.created_at.strftime('%B %d, %Y') }})
                    {% endif %}
                    {% if review.created_at %}
                      on {{ review.created_at.strftime('%B %d, %Y') }}
                    {% endif %}
                  </small>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <p>No reviews yet.</p>
          {% endif %}
        </div>
      </div>
      <a href="{{ url_for('index_views.index_page') }}" class="btn btn-secondary">Back to Listings</a>
    {% else %}
      <div class="alert alert-danger">Listing not found</div>
      <a href="{{ url_for('index_views.index_page') }}" class="btn btn-secondary">Back to Listings</a>
    {% endif %}
  </div>
{% endblock %}